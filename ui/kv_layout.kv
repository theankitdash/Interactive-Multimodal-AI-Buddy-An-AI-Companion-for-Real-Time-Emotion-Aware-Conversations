<RootWidget>:
    FloatLayout:
        # ---------------- Background ----------------
        canvas.before:
            Color:
                rgba: 0.039, 0.039, 0.039, 1  # #0a0a0a
            Rectangle:
                pos: self.pos
                size: self.size

        # ---------------- Camera Full Screen Background ----------------
        Image:
            id: camera_preview
            size_hint: 1, 1
            pos_hint: {"x": 0, "y": 0}
            fit_mode: "cover"
            opacity: 1 if root.is_camera_on else 0

        # ================ LOGIN/REGISTER SCREEN ================
        # Center overlay for login/register
        BoxLayout:
            orientation: "vertical"
            size_hint: 0.35, None
            height: self.minimum_height
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            spacing: "16dp"
            padding: ["24dp", "24dp", "24dp", "24dp"]
            opacity: 0 if root.mode == "assistant" else 1
            disabled: True if root.mode == "assistant" else False

            canvas.before:
                # Glassmorphism background
                Color:
                    rgba: 0.078, 0.078, 0.078, 0.6  # #141414 at 60% opacity
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [16, 16, 16, 16]
                # Border
                Color:
                    rgba: 1, 1, 1, 0.1
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, 16, 16, 16, 16]
                    width: 1

            # Title
            Label:
                text: "Deva"
                size_hint_y: None
                height: "80dp"
                font_size: "56sp"
                bold: True
                color: 1, 1, 1, 1
                canvas.before:
                    # Gradient text effect (approximation)
                    Color:
                        rgba: 0.388, 0.4, 0.945, 1  # #6366f1
                    Rectangle:
                        pos: self.pos
                        size: self.size

            Label:
                text: "Your AI Companion"
                size_hint_y: None
                height: "24dp"
                font_size: "14sp"
                color: 0.639, 0.639, 0.639, 1  # #a3a3a3

            Widget:
                size_hint_y: None
                height: "12dp"

            # Username input (registration only)
            TextInput:
                id: username_input
                hint_text: "Username"
                size_hint_y: None
                height: "48dp" if root.mode == "register" else 0
                opacity: 1 if root.mode == "register" else 0
                disabled: False if root.mode == "register" else True
                background_normal: ""
                background_color: 0.078, 0.078, 0.086, 1  # #141416
                foreground_color: 0.929, 0.929, 0.929, 1  # #ededed
                padding: ["16dp", "14dp"]
                font_size: "15sp"
                multiline: False
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 0.1
                    Line:
                        rounded_rectangle: [self.x, self.y, self.width, self.height, 12, 12, 12, 12]
                        width: 1

            # Full Name input (registration only)
            TextInput:
                id: fullname_input
                hint_text: "Full Name"
                size_hint_y: None
                height: "48dp" if root.mode == "register" else 0
                opacity: 1 if root.mode == "register" else 0
                disabled: False if root.mode == "register" else True
                background_normal: ""
                background_color: 0.078, 0.078, 0.086, 1
                foreground_color: 0.929, 0.929, 0.929, 1
                padding: ["16dp", "14dp"]
                font_size: "15sp"
                multiline: False
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 0.1
                    Line:
                        rounded_rectangle: [self.x, self.y, self.width, self.height, 12, 12, 12, 12]
                        width: 1

            # Status label
            Label:
                id: status_label
                size_hint_y: None
                height: "28dp"
                color: 0.8, 0.85, 0.9, 1
                font_size: "13sp"
                text: ""

            # Action button (Login/Register)
            Button:
                id: action_button
                text: "Login" if root.mode == "login" else "Register"
                size_hint_y: None
                height: "52dp"
                background_normal: ""
                background_color: 0, 0, 0, 0
                color: 1, 1, 1, 1
                font_size: "16sp"
                bold: True
                on_release: root.do_action()
                canvas.before:
                    # Gradient background
                    Color:
                        rgba: 0.388, 0.4, 0.945, 1  # #6366f1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [14, 14, 14, 14]
                    # Glow effect
                    Color:
                        rgba: 0.388, 0.4, 0.945, 0.3
                    RoundedRectangle:
                        pos: [self.x - 2, self.y - 2]
                        size: [self.width + 4, self.height + 4]
                        radius: [16, 16, 16, 16]

            # Toggle Login/Register
            Button:
                id: switch_button
                text: "Switch to Register" if root.mode == "login" else "Switch to Login"
                size_hint_y: None
                height: "48dp"
                background_normal: ""
                background_color: 0.063, 0.063, 0.075, 1  # #101013
                color: 0.8, 0.85, 0.9, 1
                font_size: "14sp"
                on_release: root.toggle_mode()
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 0.1
                    Line:
                        rounded_rectangle: [self.x, self.y, self.width, self.height, 12, 12, 12, 12]
                        width: 1

        # ================ AI ASSISTANT SCREEN ================
        
        # Top Left - Profile Badge
        FloatLayout:
            size_hint: None, None
            size: "56dp", "56dp"
            pos_hint: {"x": 0.02, "top": 0.96}
            opacity: 1 if root.mode == "assistant" else 0
            disabled: True if root.mode != "assistant" else False

            Label:
                id: profile_badge
                text: root.user_initials
                size_hint: 1, 1
                font_size: "22sp"
                bold: True
                color: 1, 1, 1, 1
                canvas.before:
                    # Gradient background
                    Color:
                        rgba: 0.388, 0.4, 0.945, 1
                    Ellipse:
                        pos: self.pos
                        size: self.size

        # Bottom Left - Logout Button
        Button:
            id: logout_button
            text: "Logout"
            size_hint: None, None
            size: "100dp", "48dp"
            pos_hint: {"x": 0.02, "y": 0.02}
            opacity: 1 if root.mode == "assistant" else 0
            disabled: True if root.mode != "assistant" else False
            background_normal: ""
            background_color: 0, 0, 0, 0
            color: 0.929, 0.929, 0.929, 1
            font_size: "15sp"
            on_release: root.handle_logout()
            canvas.before:
                # Glass card background
                Color:
                    rgba: 0.078, 0.078, 0.078, 0.6
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [12, 12, 12, 12]
                Color:
                    rgba: 1, 1, 1, 0.1
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, 12, 12, 12, 12]
                    width: 1

        # Center - AI Agent State
        FloatLayout:
            size_hint: None, None
            size: "320dp", "280dp"
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            opacity: 1 if root.mode == "assistant" else 0
            disabled: True if root.mode != "assistant" else False

            BoxLayout:
                orientation: "vertical"
                spacing: "24dp"
                pos_hint: {"center_x": 0.5, "center_y": 0.5}
                size_hint: None, None
                size: "320dp", "280dp"

                # AI State Indicator
                FloatLayout:
                    size_hint: None, None
                    size: "128dp", "128dp"
                    pos_hint: {"center_x": 0.5}

                    # Outer glow ring
                    Widget:
                        id: ai_glow_outer
                        size_hint: None, None
                        size: "128dp", "128dp"
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        canvas.before:
                            Color:
                                rgba: root.get_state_color()[0], root.get_state_color()[1], root.get_state_color()[2], 0.2
                            Ellipse:
                                pos: self.pos
                                size: self.size

                    # Main circle
                    Widget:
                        id: ai_circle_main
                        size_hint: None, None
                        size: "128dp", "128dp"
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        canvas.before:
                            Color:
                                rgba: root.get_state_color()[0], root.get_state_color()[1], root.get_state_color()[2], 0.8
                            Ellipse:
                                pos: self.pos
                                size: self.size

                    # Inner circle
                    Widget:
                        id: ai_circle_inner
                        size_hint: None, None
                        size: "96dp", "96dp"
                        pos_hint: {"center_x": 0.5, "center_y": 0.5}
                        canvas.before:
                            Color:
                                rgba: root.get_state_color()
                            Ellipse:
                                pos: self.pos
                                size: self.size

                    # Clickable overlay
                    Button:
                        size_hint: 1, 1
                        background_normal: ""
                        background_color: 0, 0, 0, 0
                        on_release: root.cycle_ai_state()

                # State Label
                Label:
                    id: ai_state_label
                    text: root.ai_state.capitalize()
                    size_hint_y: None
                    height: "32dp"
                    font_size: "20sp"
                    color: 0.929, 0.929, 0.929, 1

                # Media Controls
                BoxLayout:
                    orientation: "horizontal"
                    size_hint: None, None
                    size: "160dp", "64dp"
                    pos_hint: {"center_x": 0.5}
                    spacing: "16dp"

                    # Mute/Unmute Button
                    Button:
                        id: mute_button
                        size_hint: None, None
                        size: "64dp", "64dp"
                        background_normal: ""
                        background_color: 0, 0, 0, 0
                        on_release: root.toggle_mute()
                        canvas.before:
                            # Glass card background
                            Color:
                                rgba: 0.937, 0.267, 0.267, 1 if root.is_muted else 0.078
                                a: 0.6 if not root.is_muted else 1
                            Ellipse:
                                pos: self.pos
                                size: self.size
                            Color:
                                rgba: 1, 1, 1, 0.1
                            Line:
                                circle: [self.center_x, self.center_y, 32]
                                width: 1

                        # Icon (simplified text icon)
                        Label:
                            text: "ðŸ”‡" if root.is_muted else "ðŸ”Š"
                            font_size: "24sp"
                            pos: self.parent.pos
                            size: self.parent.size

                    # Camera Toggle Button
                    Button:
                        id: camera_button
                        size_hint: None, None
                        size: "64dp", "64dp"
                        background_normal: ""
                        background_color: 0, 0, 0, 0
                        on_release: root.toggle_camera()
                        canvas.before:
                            # Glass card background
                            Color:
                                rgba: 0.937, 0.267, 0.267, 1 if not root.is_camera_on else 0.078
                                a: 0.6 if root.is_camera_on else 1
                            Ellipse:
                                pos: self.pos
                                size: self.size
                            Color:
                                rgba: 1, 1, 1, 0.1
                            Line:
                                circle: [self.center_x, self.center_y, 32]
                                width: 1

                        # Icon (simplified text icon)
                        Label:
                            text: "ðŸ“¹" if root.is_camera_on else "ðŸš«"
                            font_size: "24sp"
                            pos: self.parent.pos
                            size: self.parent.size

        # Bottom Right - Video Preview
        FloatLayout:
            size_hint: None, None
            size: "264dp", "200dp"
            pos_hint: {"right": 0.98, "y": 0.02}
            opacity: 1 if root.mode == "assistant" and root.is_camera_on else 0
            disabled: True if root.mode != "assistant" else False

            canvas.before:
                # Glass card background
                Color:
                    rgba: 0.078, 0.078, 0.078, 0.6
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [12, 12, 12, 12]
                Color:
                    rgba: 1, 1, 1, 0.1
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, 12, 12, 12, 12]
                    width: 1

            Image:
                id: camera_preview_small
                size_hint: 1, 1
                pos_hint: {"x": 0, "y": 0}
                fit_mode: "cover"
                canvas.before:
                    Color:
                        rgba: 0.078, 0.078, 0.13, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [12, 12, 12, 12]
